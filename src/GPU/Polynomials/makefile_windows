# This makefile is for the command line version
# of the Microsoft Visual Studio Compiler on Windows 10.
# The option '-O3' is unknown and replaced by '-O2'.

# location for the code for multiple double precision
MPD=../Norms
# location for the code for monomial evaluation and differentiation
CNV=../Convolutions

# architecture flag
smflag=sm_70

# location of the command line Microsoft Visual Studio Compiler
CL="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.25.28610\bin\Hostx64\x64"

# include path for the Microsoft Visual Studio Compiler
includepath="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.25.28610\include"

# include path for the Windows Kit
winkitucrt="C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt"

# libaries of the Microsoft Visual Studio compiler
libdirvs="C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.25.28610\lib\x64"

# libraries of the Windows Kits
libdirkitum="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\um\x64"
libdirkitucrt="C:\Program Files (x86)\Windows Kits\10\Lib\10.0.18362.0\ucrt\x64"

# include files of the CUDA SDK
CUDASDK="C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2"
# library folder of the CUDA SDK
CUDALIB="C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2\lib\x64"

double_double_functions.obj:
	@-echo ">>> compiling double double functions ..."
	$(CL)\cl /c -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(MPD)/double_double_functions.cpp \
                 /Fo: double_double_functions.obj /EHsc

random_numbers.obj:
	@-echo ">>> compiling double random number generators ..."
	$(CL)\cl /c -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(MPD)/random_numbers.cpp \
                 /Fo: random_numbers.obj /EHsc

random2_vectors.obj:
	@-echo ">>> compiling double double random number generators ..."
	$(CL)\cl /c -I$(MPD) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(MPD)/random2_vectors.cpp \
                 /Fo: random2_vectors.obj /EHsc

random_series.obj:
	@-echo ">>> compiling double random series generators ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(CNV)/random_series.cpp \
                 /Fo: random_series.obj /EHsc

random2_series.obj:
	@-echo ">>> compiling double double random series generators ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(CNV)/random2_series.cpp \
                 /Fo: random2_series.obj /EHsc

random_monomials.obj:
	@-echo ">>> compiling double random monomials generators ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(CNV)/random_monomials.cpp \
                 /Fo: random_monomials.obj /EHsc

random2_monomials.obj:
	@-echo ">>> compiling double double random monomials generators ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) -I$(winkitucrt) -I$(includepath) -O2 \
                      $(CNV)/random2_monomials.cpp \
                 /Fo: random2_monomials.obj /EHsc

random_polynomials.obj:
	@-echo ">>> compiling double random polynomials generators ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) -I$(winkitucrt) -I$(includepath) -O2 \
                      random_polynomials.cpp \
                 /Fo: random_polynomials.obj /EHsc

random2_polynomials.obj:
	@-echo ">>> compiling double double random polynomials generators ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) -I$(winkitucrt) -I$(includepath) -O2 \
                      random2_polynomials.cpp \
                 /Fo: random2_polynomials.obj /EHsc

dbl_convolutions_host.obj:
	@-echo ">>> compiling dbl_convolutions_host ..."
	$(CL)\cl /c -I$(CNV) $(CNV)/dbl_convolutions_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /Fo: dbl_convolutions_host.obj

dbl2_convolutions_host.obj:
	@-echo ">>> compiling dbl2_convolutions_host ..."
	$(CL)\cl /c -I$(MPD) -I$(CNV) $(CNV)/dbl2_convolutions_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -O2 \
                 /Fo: dbl2_convolutions_host.obj

dbl_monomials_host.obj:
	@-echo ">>> compiling dbl_monomials_host ..."
	$(CL)\cl /c $(CNV)/dbl_monomials_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -02 \
                 /Fo: dbl_monomials_host.obj /EHsc

dbl2_monomials_host.obj:
	@-echo ">>> compiling dbl2_monomials_host ..."
	$(CL)\cl /c $(CNV)/dbl2_monomials_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -02 \
                 /Fo: dbl2_monomials_host.obj /EHsc

dbl_polynomials_kernels.obj:
	@-echo ">>> compiling polynomial kernels for doubles ..."
	nvcc -ccbin=$(CL) -arch=$(smflag) -c -O3 -I$(MPD) -I$(CNV) \
                dbl_polynomials_kernels.cu \
             -o dbl_polynomials_kernels.obj

dbl2_polynomials_kernels.obj:
	@-echo ">>> compiling polynomial kernels for double doubles ..."
	nvcc -ccbin=$(CL) -arch=$(smflag) -c -O3 -I$(MPD) -I$(CNV) \
             --define-macro gpufun=1 \
                dbl2_polynomials_kernels.cu \
             -o dbl2_polynomials_kernels.obj

dbl_polynomials_host.obj:
	@-echo ">>> compiling dbl_polynomials_host ..."
	$(CL)\cl /c dbl_polynomials_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl_polynomials_host.obj /EHsc

dbl2_polynomials_host.obj:
	@-echo ">>> compiling dbl2_polynomials_host ..."
	$(CL)\cl /c dbl2_polynomials_host.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: dbl2_polynomials_host.obj /EHsc

test_dbl_polynomials.obj:
	@-echo ">>> compiling test_dbl_polynomials ..."
	$(CL)\cl /c test_dbl_polynomials.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_dbl_polynomials.obj /EHsc

test_dbl2_polynomials.obj:
	@-echo ">>> compiling test_dbl2_polynomials ..."
	$(CL)\cl /c test_dbl2_polynomials.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /I$(CUDASDK)/include \
                 /Fo: test_dbl2_polynomials.obj /EHsc

convolution_job.obj:
	@-echo ">>> compiling convolution_job ..."
	$(CL)\cl /c convolution_job.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /Fo: convolution_job.obj /EHsc

convolution_jobs.obj:
	@-echo ">>> compiling convolution_jobs ..."
	$(CL)\cl /c convolution_jobs.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /Fo: convolution_jobs.obj /EHsc

test_convolution_jobs.obj:
	@-echo ">>> compiling test_convolution_jobs ..."
	$(CL)\cl /c test_convolution_jobs.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /Fo: test_convolution_jobs.obj /EHsc

addition_job.obj:
	@-echo ">>> compiling addition_job ..."
	$(CL)\cl /c addition_job.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /Fo: addition_job.obj /EHsc

addition_jobs.obj:
	@-echo ">>> compiling addition_jobs ..."
	$(CL)\cl /c addition_jobs.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /Fo: addition_jobs.obj /EHsc

test_addition_jobs.obj:
	@-echo ">>> compiling test_addition_jobs ..."
	$(CL)\cl /c test_addition_jobs.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /Fo: test_addition_jobs.obj /EHsc

write_job_counts.obj:
	@-echo ">>> compiling write_job_counts ..."
	$(CL)\cl /c write_job_counts.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /Fo: write_job_counts.obj /EHsc

job_coordinates.obj:
	@-echo ">>> compiling job_coordinates ..."
	$(CL)\cl /c job_coordinates.cpp \
                 -I$(winkitucrt) -I$(includepath) -I$(MPD) -I$(CNV) -O2 \
                 /Fo: job_coordinates.obj /EHsc

test_convolution_jobs: random_numbers.obj random_series.obj \
	               random_monomials.obj random_polynomials.obj \
                       convolution_job.obj convolution_jobs.obj \
                       test_convolution_jobs.obj 
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_convolution_jobs.exe \
              random_numbers.obj random_series.obj random_monomials.obj \
              random_polynomials.obj convolution_job.obj \
              convolution_jobs.obj test_convolution_jobs.obj

test_addition_jobs: random_numbers.obj random_series.obj \
	            random_monomials.obj random_polynomials.obj \
                    addition_job.obj addition_jobs.obj test_addition_jobs.obj 
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_addition_jobs.exe \
              random_numbers.obj random_series.obj random_monomials.obj \
              random_polynomials.obj addition_job.obj addition_jobs.obj \
              test_addition_jobs.obj

test_dbl_polynomials: random_numbers.obj random_series.obj \
	              random_monomials.obj random_polynomials.obj \
                      convolution_job.obj convolution_jobs.obj \
                      addition_job.obj addition_jobs.obj \
                      job_coordinates.obj write_job_counts.obj \
                    dbl_convolutions_host.obj dbl_monomials_host.obj \
                    dbl_polynomials_host.obj dbl_polynomials_kernels.obj \
                    test_dbl_polynomials.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_dbl_polynomials.exe \
              random_numbers.obj random_series.obj random_monomials.obj \
              random_polynomials.obj convolution_job.obj convolution_jobs.obj \
              addition_job.obj addition_jobs.obj \
              job_coordinates.obj write_job_counts.obj \
              dbl_convolutions_host.obj dbl_monomials_host.obj \
              dbl_polynomials_host.obj dbl_polynomials_kernels.obj \
              test_dbl_polynomials.obj

test_dbl2_polynomials: random_numbers.obj random_series.obj \
	               random_monomials.obj random_polynomials.obj \
                       double_double_functions.obj \
                       random2_vectors.obj random2_series.obj \
                       random2_monomials.obj random2_polynomials.obj \
                       convolution_job.obj convolution_jobs.obj \
                       addition_job.obj addition_jobs.obj \
                       job_coordinates.obj write_job_counts.obj \
                       dbl2_convolutions_host.obj dbl2_monomials_host.obj \
                       dbl2_polynomials_host.obj dbl2_polynomials_kernels.obj \
		       test_dbl2_polynomials.obj
	@-echo ">>> linking ..."
	nvcc -ccbin=$(CL) -o test_dbl2_polynomials.exe \
              random_numbers.obj random_series.obj random_monomials.obj \
              random_polynomials.obj double_double_functions.obj \
              random2_vectors.obj random2_series.obj \
              random2_monomials.obj random2_polynomials.obj \
              convolution_job.obj convolution_jobs.obj \
              addition_job.obj addition_jobs.obj \
              job_coordinates.obj write_job_counts.obj \
              dbl2_convolutions_host.obj dbl2_monomials_host.obj \
              dbl2_polynomials_host.obj dbl2_polynomials_kernels.obj \
              test_dbl2_polynomials.obj

clean:
	del *~
	del test_dbl2_polynomials.exe test_dbl2_polynomials.obj
	del test_dbl2_polynomials.exp test_dbl2_polynomials.lib
	del random2_polynomials.obj dbl2_polynomials_host.obj
	del dbl2_polynomials_kernels.obj
	del test_dbl_polynomials.exe test_dbl_polynomials.obj
	del test_dbl_polynomials.exp test_dbl_polynomials.lib
	del dbl_polynomials_host.obj random_polynomials.obj
	del dbl_polynomials_kernels.obj
	del test_convolution_jobs.exe test_convolution_jobs.lib
	del convolution_job.obj convolution_jobs.obj
	del test_convolution_jobs.exp test_convolution_jobs.obj
	del addition_job.obj addition_jobs.obj
	del test_addition_jobs.exe test_addition_jobs.lib
	del test_addition_jobs.exp test_addition_jobs.obj
	del job_coordinates.obj write_job_counts.obj

cleanall: clean
	del *exe *obj *exp *lib
